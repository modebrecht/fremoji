<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Franz√∂sisch Trainer Pro (Lvl 1 & 2)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Nunito:wght@400;700&display=swap');

        body { font-family: 'Nunito', sans-serif; background-color: #f0fdf4; }
        h1, h2, h3, .emoji-display { font-family: 'Fredoka', sans-serif; }

        .emoji-bounce { animation: bounce 2s infinite; }
        @keyframes bounce {
            0%, 100% { transform: translateY(-5%); }
            50% { transform: translateY(5%); }
        }

        .btn-option { transition: all 0.2s; }
        .btn-option:active { transform: scale(0.95); }

        .fade-in { animation: fadeIn 0.4s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .correct-anim { background-color: #86efac !important; border-color: #22c55e !important; color: #064e3b !important; }
        .wrong-anim { background-color: #fca5a5 !important; border-color: #ef4444 !important; color: #7f1d1d !important; animation: shake 0.5s; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Locked State */
        .locked { opacity: 0.6; cursor: not-allowed; filter: grayscale(100%); position: relative; }
        .level-badge { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; font-weight: bold; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-blue-100 via-indigo-100 to-purple-100">

    <div class="w-full max-w-lg bg-white rounded-3xl shadow-2xl overflow-hidden border-4 border-white min-h-[650px] flex flex-col">
        
        <div class="bg-indigo-600 p-4 text-white flex justify-between items-center shadow-md z-10">
            <div class="flex items-center gap-2">
                <span class="text-2xl">üá´üá∑</span>
                <span class="font-bold text-lg leading-tight">Pro Trainer<br><span class="text-indigo-200 text-xs font-normal">Wortschatz & Grammatik</span></span>
            </div>
            <div class="flex gap-2">
                <button onclick="resetProgress()" class="text-xs bg-indigo-800 hover:bg-red-600 px-2 py-1 rounded transition text-indigo-200 hover:text-white" title="Fortschritt l√∂schen">üóëÔ∏è Reset</button>
                <button onclick="goToMenu()" id="home-btn" class="hidden text-xs bg-indigo-700 hover:bg-indigo-800 px-3 py-1 rounded-lg transition">üè† Men√º</button>
            </div>
        </div>

        <div id="menu-screen" class="p-6 fade-in flex-grow flex flex-col">
            <h2 class="text-2xl text-center font-bold text-gray-700 mb-6">W√§hle deine Challenge</h2>
            <div class="grid grid-cols-1 gap-4 overflow-y-auto pb-4" id="category-grid">
                </div>
        </div>

        <div id="game-screen" class="hidden flex-grow flex flex-col">
            <div class="w-full bg-gray-200 h-2">
                <div class="bg-green-500 h-2 transition-all duration-500" style="width: 0%" id="progress-bar"></div>
            </div>

            <div class="p-6 text-center fade-in flex-grow flex flex-col justify-center">
                <div class="flex justify-between items-center mb-2">
                     <span class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded text-xs font-bold uppercase tracking-wider" id="topic-label">THEMA</span>
                     <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs font-bold uppercase tracking-wider" id="level-label">LEVEL 1</span>
                </div>
                
                <div class="text-8xl mb-4 mt-2 emoji-display emoji-bounce drop-shadow-md cursor-default select-none" id="emoji-container">ü§î</div>
                
                <div id="word-hint" class="text-2xl font-bold text-gray-600 mb-6 h-8"></div>

                <div class="grid grid-cols-1 gap-3" id="options-container">
                    </div>
                
                <div class="mt-auto pt-6 flex justify-between text-gray-400 text-xs font-mono">
                    <span>Frage <span id="current-q">1</span>/<span id="total-q">10</span></span>
                    <span id="score-display">Punkte: 0</span>
                </div>
            </div>
        </div>

        <div id="result-screen" class="hidden p-6 text-center fade-in flex-grow flex flex-col overflow-y-auto">
            <div class="text-6xl mb-2">üìä</div>
            <h2 class="text-2xl font-bold text-gray-800 mb-1">Ergebnis</h2>
            
            <div class="bg-indigo-50 rounded-xl p-4 mb-6 border-2 border-indigo-100 shadow-inner">
                <div class="flex justify-around items-end">
                    <div>
                        <div class="text-xs text-gray-500 uppercase font-bold">Richtig</div>
                        <div class="text-4xl font-bold text-green-600" id="final-score">0/10</div>
                    </div>
                    <div>
                        <div class="text-xs text-gray-500 uppercase font-bold">Quote</div>
                        <div class="text-4xl font-bold text-indigo-600" id="final-percent">0%</div>
                    </div>
                </div>
            </div>

            <div id="unlock-msg" class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-4 text-left rounded shadow-sm">
                <p class="font-bold">üîì Level 2 Freigeschaltet!</p>
                <p class="text-sm">Du kannst jetzt die Grammatik-Challenge f√ºr dieses Thema spielen.</p>
            </div>

            <div id="mistakes-container" class="hidden text-left mb-6">
                <h3 class="text-red-500 font-bold mb-3 border-b pb-1">‚ö†Ô∏è Deine Fehler:</h3>
                <div class="space-y-2 text-sm" id="mistakes-list"></div>
            </div>
            
            <div id="perfect-msg" class="hidden text-green-600 font-bold text-lg mb-6">Perfekt! Keine Fehler! üéâ</div>

            <div class="mt-auto space-y-3">
                <button onclick="goToMenu()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl shadow-lg transition">
                    Zur√ºck zum Men√º üè†
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const categories = [
            { id: 'essen', title: 'Essen', icon: 'ü•ê', color: 'bg-orange-50 border-orange-200', questions: [
                { emoji: "ü•ê", correct: "le croissant" }, { emoji: "üßÄ", correct: "le fromage" },
                { emoji: "üçü", correct: "les frites" }, { emoji: "üçé", correct: "la pomme" },
                { emoji: "üçû", correct: "le pain" }, { emoji: "üçó", correct: "le poulet" },
                { emoji: "ü•ö", correct: "l'≈ìuf" }, { emoji: "ü•ó", correct: "la salade" },
                { emoji: "üç´", correct: "le chocolat" }, { emoji: "üç¶", correct: "la glace" }
            ]},
            { id: 'trinken', title: 'Getr√§nke', icon: 'ü•§', color: 'bg-blue-50 border-blue-200', questions: [
                { emoji: "üíß", correct: "l'eau" }, { emoji: "‚òï", correct: "le caf√©" },
                { emoji: "ü•õ", correct: "le lait" }, { emoji: "üßÉ", correct: "le jus" },
                { emoji: "üçµ", correct: "le th√©" }, { emoji: "üç∑", correct: "le vin" },
                { emoji: "üç∫", correct: "la bi√®re" }, { emoji: "ü•§", correct: "le soda" },
                { emoji: "üçã", correct: "la limonade" }, { emoji: "üçº", correct: "le biberon" }
            ]},
            { id: 'kleidung', title: 'Kleidung', icon: 'üëó', color: 'bg-pink-50 border-pink-200', questions: [
                { emoji: "üëñ", correct: "le pantalon" }, { emoji: "üëó", correct: "la robe" },
                { emoji: "üëï", correct: "le t-shirt" }, { emoji: "üëü", correct: "les chaussures" },
                { emoji: "üëì", correct: "les lunettes" }, { emoji: "üß•", correct: "le manteau" },
                { emoji: "üß¢", correct: "la casquette" }, { emoji: "üß¶", correct: "les chaussettes" },
                { emoji: "üëî", correct: "la chemise" }, { emoji: "üß£", correct: "l'√©charpe" }
            ]},
            { id: 'tiere', title: 'Tiere', icon: 'üêæ', color: 'bg-green-50 border-green-200', questions: [
                { emoji: "üêï", correct: "le chien" }, { emoji: "üêà", correct: "le chat" },
                { emoji: "üêé", correct: "le cheval" }, { emoji: "üê¶", correct: "l'oiseau" },
                { emoji: "üêü", correct: "le poisson" }, { emoji: "üêÑ", correct: "la vache" },
                { emoji: "üêñ", correct: "le cochon" }, { emoji: "ü¶Å", correct: "le lion" },
                { emoji: "üêò", correct: "l'√©l√©phant" }, { emoji: "üêí", correct: "le singe" }
            ]},
            { id: 'schule', title: 'Schule', icon: 'üè´', color: 'bg-yellow-50 border-yellow-200', questions: [
                { emoji: "üñäÔ∏è", correct: "le stylo" }, { emoji: "üìö", correct: "les livres" },
                { emoji: "üéí", correct: "le sac √† dos" }, { emoji: "üíª", correct: "l'ordinateur" },
                { emoji: "‚úÇÔ∏è", correct: "les ciseaux" }, { emoji: "üìè", correct: "la r√®gle" },
                { emoji: "üìù", correct: "le devoir" }, { emoji: "üè´", correct: "l'√©cole" },
                { emoji: "ü™ë", correct: "la chaise" }, { emoji: "üñçÔ∏è", correct: "le crayon" }
            ]},
            { id: 'transport', title: 'Verkehr', icon: 'üöÜ', color: 'bg-gray-50 border-gray-200', questions: [
                { emoji: "üöó", correct: "la voiture" }, { emoji: "üöÜ", correct: "le train" },
                { emoji: "‚úàÔ∏è", correct: "l'avion" }, { emoji: "üö≤", correct: "le v√©lo" },
                { emoji: "üöå", correct: "le bus" }, { emoji: "üö§", correct: "le bateau" },
                { emoji: "üèçÔ∏è", correct: "la moto" }, { emoji: "üöÅ", correct: "l'h√©licopt√®re" },
                { emoji: "üöá", correct: "le m√©tro" }, { emoji: "üéüÔ∏è", correct: "le billet" }
            ]},
            { id: 'haus', title: 'Haus', icon: 'üè†', color: 'bg-teal-50 border-teal-200', questions: [
                { emoji: "üè†", correct: "la maison" }, { emoji: "üõèÔ∏è", correct: "le lit" },
                { emoji: "üõÅ", correct: "la baignoire" }, { emoji: "üõãÔ∏è", correct: "le canap√©" },
                { emoji: "üì∫", correct: "la t√©l√©" }, { emoji: "üóùÔ∏è", correct: "la cl√©" },
                { emoji: "üö™", correct: "la porte" }, { emoji: "üçΩÔ∏è", correct: "la table" },
                { emoji: "üå≥", correct: "le jardin" }, { emoji: "üöΩ", correct: "les toilettes" }
            ]},
            { id: 'sport', title: 'Sport', icon: '‚öΩ', color: 'bg-red-50 border-red-200', questions: [
                { emoji: "‚öΩ", correct: "le foot" }, { emoji: "üéæ", correct: "le tennis" },
                { emoji: "üèÄ", correct: "le basket" }, { emoji: "üèä", correct: "la natation" },
                { emoji: "üéø", correct: "le ski" }, { emoji: "üèÖ", correct: "la m√©daille" },
                { emoji: "üö¥", correct: "le cyclisme" }, { emoji: "ü•ä", correct: "la boxe" },
                { emoji: "üßò", correct: "le yoga" }, { emoji: "üèÜ", correct: "le champion" }
            ]}
        ];

        // Global Distractors for Level 1 (vocabulary mix)
        const globalVocab = categories.flatMap(c => c.questions.map(q => q.correct));

        // --- STATE MANAGEMENT ---
        let userProgress = JSON.parse(localStorage.getItem('frenchQuizProgress')) || {};
        let currentSet = [];
        let currentIndex = 0;
        let score = 0;
        let wrongAnswers = [];
        let isAnswerLocked = false;
        let activeCategoryIndex = null;
        let activeLevel = 1;

        // --- LOCAL STORAGE HELPERS ---
        function saveProgress(catId, level) {
            if (!userProgress[catId]) userProgress[catId] = { l1: false, l2: false };
            if (level === 1) userProgress[catId].l1 = true;
            if (level === 2) userProgress[catId].l2 = true;
            localStorage.setItem('frenchQuizProgress', JSON.stringify(userProgress));
        }

        function resetProgress() {
            if(confirm("Alles l√∂schen?")) {
                localStorage.removeItem('frenchQuizProgress');
                userProgress = {};
                initMenu();
            }
        }

        // --- MENU GENERATION ---
        function initMenu() {
            const grid = document.getElementById('category-grid');
            grid.innerHTML = '';
            
            categories.forEach((cat, index) => {
                const status = userProgress[cat.id] || { l1: false, l2: false };
                const isL2Unlocked = status.l1 === true;

                const card = document.createElement('div');
                card.className = `p-4 rounded-2xl border shadow-sm flex items-center justify-between ${cat.color}`;
                
                let l2ButtonClass = isL2Unlocked 
                    ? 'bg-yellow-500 hover:bg-yellow-600 text-white shadow-md' 
                    : 'bg-gray-300 text-gray-500 locked shadow-none';
                
                let l2Icon = isL2Unlocked ? '‚ö°' : 'üîí';
                
                card.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="text-3xl">${cat.icon}</div>
                        <div class="font-bold text-gray-800">${cat.title}</div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="startGame(${index}, 1)" class="flex flex-col items-center justify-center w-16 h-14 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow-md transition transform active:scale-95">
                            <span class="text-lg">üìñ</span>
                            <span class="level-badge">Lvl 1</span>
                        </button>
                        <button onclick="${isL2Unlocked ? `startGame(${index}, 2)` : ''}" class="flex flex-col items-center justify-center w-16 h-14 rounded-xl transition transform active:scale-95 ${l2ButtonClass}">
                            <span class="text-lg">${l2Icon}</span>
                            <span class="level-badge">Lvl 2</span>
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });

            document.getElementById('menu-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('home-btn').classList.add('hidden');
        }

        // --- HELPER: ANALYZE ANSWER FOR LEVEL 2 ---
        function splitArticleWord(fullString) {
            // Basic French articles to split
            const articles = ['le', 'la', 'l\'', 'les', 'un', 'une', 'des'];
            let foundArticle = "";
            let noun = fullString;

            for (let art of articles) {
                if (fullString.startsWith(art + " ") || fullString.startsWith(art)) {
                    // Check specifically for l' case which doesn't always have space
                    if (art === "l'") {
                        foundArticle = "l'";
                        noun = fullString.substring(2);
                    } else {
                        foundArticle = art;
                        noun = fullString.substring(art.length).trim();
                    }
                    break;
                }
            }
            return { article: foundArticle, noun: noun };
        }

        // --- GAME LOGIC ---
        function startGame(catIndex, level) {
            activeCategoryIndex = catIndex;
            activeLevel = level;
            const category = categories[catIndex];
            
            // Randomize Questions
            currentSet = shuffleArray([...category.questions]);
            
            currentIndex = 0;
            score = 0;
            wrongAnswers = [];
            isAnswerLocked = false;

            // UI Setup
            document.getElementById('topic-label').innerText = category.title;
            document.getElementById('level-label').innerText = level === 1 ? "Level 1: Vokabeln" : "Level 2: Artikel";
            document.getElementById('menu-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('home-btn').classList.remove('hidden');
            document.getElementById('score-display').innerText = `Punkte: 0`;

            loadQuestion();
        }

        function loadQuestion() {
            if (currentIndex >= currentSet.length) {
                endGame();
                return;
            }

            const q = currentSet[currentIndex];
            const container = document.getElementById('options-container');
            const wordHint = document.getElementById('word-hint');
            container.innerHTML = '';
            
            // Update Progress
            document.getElementById('emoji-container').innerText = q.emoji;
            document.getElementById('current-q').innerText = currentIndex + 1;
            document.getElementById('total-q').innerText = currentSet.length;
            document.getElementById('progress-bar').style.width = `${(currentIndex / currentSet.length) * 100}%`;

            let correctVal = "";
            let options = [];

            if (activeLevel === 1) {
                // LEVEL 1: Vocabulary (Full Word)
                wordHint.innerText = ""; // No text hint
                correctVal = q.correct;
                // Generate distractors from global pool + category specifics
                const randomDistractors = shuffleArray(globalVocab.filter(w => w !== q.correct)).slice(0, 3);
                options = shuffleArray([q.correct, ...randomDistractors]);
            } else {
                // LEVEL 2: Grammar (Article Selection)
                const parts = splitArticleWord(q.correct);
                correctVal = parts.article;
                wordHint.innerText = `... ${parts.noun}`; // Show "___ croissant"
                
                // Fixed Grammar Options
                options = ["le", "la", "l'", "les"];
                // If the answer is un/une/des, we should adapt, but data is mostly le/la.
                // If answer is not in standard list, add it.
                if (!options.includes(correctVal)) {
                    options.pop();
                    options.push(correctVal);
                    options = shuffleArray(options);
                }
            }

            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn-option w-full bg-white border-2 border-indigo-100 text-indigo-900 font-semibold py-4 px-4 rounded-xl hover:bg-indigo-50 hover:border-indigo-300 text-xl shadow-sm';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(btn, opt, correctVal, q);
                container.appendChild(btn);
            });

            isAnswerLocked = false;
        }

        function checkAnswer(btn, selected, correctVal, questionObj) {
            if (isAnswerLocked) return;
            isAnswerLocked = true;

            const isCorrect = selected === correctVal;
            const allBtns = document.querySelectorAll('.btn-option');

            if (isCorrect) {
                score++;
                btn.classList.add('correct-anim');
                document.getElementById('score-display').innerText = `Punkte: ${score}`;
            } else {
                btn.classList.add('wrong-anim');
                
                // Store Mistake (display full correct answer for context)
                wrongAnswers.push({
                    emoji: questionObj.emoji,
                    correct: questionObj.correct, // Show full word in result
                    selected: selected // What user clicked
                });
                
                // Highlight Correct
                allBtns.forEach(b => {
                    if (b.innerText === correctVal) {
                        b.classList.add('correct-anim');
                    }
                });
            }

            setTimeout(() => {
                currentIndex++;
                loadQuestion();
            }, 1200);
        }

        function endGame() {
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('progress-bar').style.width = `100%`;

            const total = currentSet.length;
            const catId = categories[activeCategoryIndex].id;
            
            document.getElementById('final-score').innerText = `${score}/${total}`;
            document.getElementById('final-percent').innerText = `${Math.round((score/total)*100)}%`;

            // UNLOCK LOGIC (Need 70% to unlock Level 2)
            const passed = score >= 7;
            const unlockMsg = document.getElementById('unlock-msg');
            unlockMsg.classList.add('hidden');

            if (activeLevel === 1 && passed) {
                // If not already unlocked, show message
                if (!userProgress[catId]?.l1) {
                    unlockMsg.classList.remove('hidden');
                }
                saveProgress(catId, 1);
            } else if (activeLevel === 2 && passed) {
                saveProgress(catId, 2);
            }

            // MISTAKES DISPLAY
            const mistakesContainer = document.getElementById('mistakes-container');
            const mistakesList = document.getElementById('mistakes-list');
            const perfectMsg = document.getElementById('perfect-msg');

            if (wrongAnswers.length > 0) {
                perfectMsg.classList.add('hidden');
                mistakesContainer.classList.remove('hidden');
                mistakesList.innerHTML = '';
                
                wrongAnswers.forEach(item => {
                    const row = document.createElement('div');
                    row.className = 'flex items-center justify-between bg-white p-3 rounded border border-gray-200';
                    row.innerHTML = `
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">${item.emoji}</span>
                            <div>
                                <span class="block text-xs text-red-400">Du w√§hltest: "${item.selected}"</span>
                            </div>
                        </div>
                        <div class="text-green-700 font-bold bg-green-50 px-2 py-1 rounded">
                            ${item.correct}
                        </div>
                    `;
                    mistakesList.appendChild(row);
                });
            } else {
                mistakesContainer.classList.add('hidden');
                perfectMsg.classList.remove('hidden');
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function goToMenu() {
            initMenu();
        }

        // Start
        window.onload = initMenu;
    </script>
</body>
</html>